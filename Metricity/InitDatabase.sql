DECLARE @CurrentMigration [nvarchar](max)

IF object_id('[dbo].[__MigrationHistory]') IS NOT NULL
    SELECT @CurrentMigration =
        (SELECT TOP (1) 
        [Project1].[MigrationId] AS [MigrationId]
        FROM ( SELECT 
        [Extent1].[MigrationId] AS [MigrationId]
        FROM [dbo].[__MigrationHistory] AS [Extent1]
        WHERE [Extent1].[ContextKey] = N'Metricity.Data.Migrations.Configuration'
        )  AS [Project1]
        ORDER BY [Project1].[MigrationId] DESC)

IF @CurrentMigration IS NULL
    SET @CurrentMigration = '0'

IF @CurrentMigration < '201805102012008_init'
BEGIN
    CREATE TABLE [dbo].[Metrics] (
        [MetricId] [int] NOT NULL IDENTITY,
        [AppliactionName] [nvarchar](max),
        [MethodName] [nvarchar](max),
        [Duration] [time](7) NOT NULL,
        CONSTRAINT [PK_dbo.Metrics] PRIMARY KEY ([MetricId])
    )
    CREATE TABLE [dbo].[__MigrationHistory] (
        [MigrationId] [nvarchar](150) NOT NULL,
        [ContextKey] [nvarchar](300) NOT NULL,
        [Model] [varbinary](max) NOT NULL,
        [ProductVersion] [nvarchar](32) NOT NULL,
        CONSTRAINT [PK_dbo.__MigrationHistory] PRIMARY KEY ([MigrationId], [ContextKey])
    )
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201805102012008_init', N'Metricity.Data.Migrations.Configuration',  0x1F8B0800000000000400CD57CB6E1B3714DD17E83F105CB58023FAB168638C12A8921D08896C23E3644FCD5C494439E494E418527EAD8B7E527F2197F37E58B2E20449E08D455E9E7BEEE17D70FEFFF7BFE0F53691E4018C155A8DE9D9E8941250918E855A8F69E6562FFEA4AF5FFDFA4B7015275BF2B1B2BBF0767852D931DD38975E3266A30D24DC8E1211196DF5CA8D229D301E6B767E7AFA929D9D3140088A588404EF33E54402F90FFC39D52A82D4655C2E740CD296EBB813E6A8E4862760531EC1982EC0191109B71BCDB8E3944CA4E0C82204B9A2842BA51D77C8F1F28385D019ADD6618A0B5CDEEF5240BB1597164AEE978DF9B1619C9EFB305873B0828A32EB74F285806717A52EAC7FFC59EAD25A3754EE0A15763B1F75AE5E251C257D57975369BC595FDA518E20C08E8AF513D2DD3FA9D301B3C6FF9D9069265D6660AC207386CB1372972DA588DEC2EE5EFF0D6AAC3229DB249126EE751670E9CEE8148CDBBD875587FA3CA684754FB3FEF1FAF0E06411E25CB98B734A6E90085F4AA8F3A12547E8B48137A0C07007F11D770E0C5EE73C865CD101879EC7499A6246461ECA2F548E3117B1A42859F0ED3B506BB7416E7C4BC9B5D8425CAD94643E28811588879CC9E0297F18E146C7DFC5D52C336572168EEE85773AD0B20D12B0260F87D98975EFB840A53BB7556EC0D63D92AC58D665BEDA92749772011C82EB405A4A1A1E45B31855F5F018DD9A58D38958D18AAA96C5F6F4AC60C1D314E56FF5B072858445039BBE08BFBCBA93028361240764AC3D610AF335F476D13532BD16C63A5FBF4BEE2F6B1A2703B3C135EC91B872D755BA5FCE8DF095BDFFBF77E145C729AFA487D048788D51255886798050F3A87BDBE0603E41B8E4666F5B986A9925EA709B39843428F736E060F378DC7659F738D6EBC7A33595DBC66A56874801EB69DEBF5636B8D75E6BEEA7C9A132EB9BD4DEEB72EB955550A6F8D3EF8541CE172694A0440F22F6F91EEEAC83A448C1F01F399502E36D0C165C89155857CC308A63FB7C34F98473AEF7F8F8791E02CCDA581EF51AF8A1C35878959F1CB707E7CBD1F3573D70136DB8F92DE1DBDFDBA0CF9BB15F05D79FA32E9FA3770622513CAFFFF8A65375D8F58F19990726665141631A2F358650B0ACE7EC33C7E9B09E03D6FE4A086660C5BA81F0DF0C0AF26B6E402B9BB95AE94A738CABCDA83219DE308F519E89716285D983DB11589BBFA33E7299A1C955B28478AE6E3397666E622D244BD9790D06ECB0FFFCCDD0E51CDCA6FE97FD1621204D8121C0ADFA2B1332AE795F3F923F7B207CA694A588ACF01D8970EB5D8D74A3D59140A57C334841F942BE87249508666F55C81FE039DCF0E1F70ED63CDA556D793FC8D317D1953D9809BE363CB1254673DE7FF932FFE9FBEA3346CD30662C0F0000 , N'6.2.0-61023')
END

IF @CurrentMigration < '201805102100224_fixedapplicationnamespelling'
BEGIN
    ALTER TABLE [dbo].[Metrics] ADD [ApplicationName] [nvarchar](max)
    DECLARE @var0 nvarchar(128)
    SELECT @var0 = name
    FROM sys.default_constraints
    WHERE parent_object_id = object_id(N'dbo.Metrics')
    AND col_name(parent_object_id, parent_column_id) = 'AppliactionName';
    IF @var0 IS NOT NULL
        EXECUTE('ALTER TABLE [dbo].[Metrics] DROP CONSTRAINT [' + @var0 + ']')
    ALTER TABLE [dbo].[Metrics] DROP COLUMN [AppliactionName]
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201805102100224_fixedapplicationnamespelling', N'Metricity.Data.Migrations.Configuration',  0x1F8B0800000000000400CD57CB6E1B3714DD17E83F105CB58023FAB168638C12A8921D08896C23E3644FCD5C494439E494E418527EAD8B7E527F2197F37E58B2E20449E08D455E9E7BEEE17D70FEFFF7BFE0F53691E4018C155A8DE9D9E8941250918E855A8F69E6562FFEA4AF5FFDFA4B7015275BF2B1B2BBF0767852D931DD38975E3266A30D24DC8E1211196DF5CA8D229D301E6B767E7AFA929D9D3140088A588404EF33E54402F90FFC39D52A82D4655C2E740CD296EBB813E6A8E4862760531EC1982EC0191109B71BCDB8E3944CA4E0C82204B9A2842BA51D77C8F1F28385D019ADD6618A0B5CDEEF5240BB1597164AEE978DF9B1619C9EFB305873B0828A32EB74F285806717A52EAC7FFC59EAD25A3754EE0A15763B1F75AE5E251C257D57975369BC595FDA518E20C08E8AF513D2DD3FA9D301B3C6FF9D9069265D6660AC207386CB1372972DA588DEC2EE5EFF0D6AAC3229DB249126EE751670E9CEE8148CDBBD875587FA3CA684754FB3FEF1FAF0E06411E25CB98B734A6E90085F4AA8F3A12547E8B48137A0C07007F11D770E0C5EE73C865CD101879EC7499A62C839945FA81C632E624951B2E0DB77A0D66E83DCF896926BB185B85A29C97C50022B100F3993C153FE30C28D8EBF8BAB5966CAE42C1CDD0BEF74A0651B24604D1E0EB313EBDE71814A776EABDC80AD7B2459B1ACCB7CB525E92EE5023804D781B494343C8A6631AAEAE131BA35B1A613B1A215552D8BEDE959C182A729CADFEA61E50A098B06367D117E7975270506C3480EC8587BC214E66BE8EDA26B647A2D8C75BE7E97DC5FD6344E0666836BD82371E5AEAB74BF9C1BE12B7BFF7FEFC28B8E535E490FA191F01AA34AB00CF300A1E651F7B6C1C17C8270C9CDDEB630D5324BD4E13673086950EE6DC0C1E6F1B8EDB2EE71ACD78F476B2AB78DD5AC0E9102D6D3BC7FAD6C70AFBDD6DC4F934365D637A9BDD7E5D62BABA04CF1A7DF0B839C2F4C2841891E44ECF33DDC5907499182E13F722A05C6DB182CB8122BB0AE986114C7F6F968F209E75CEFF1F1F33C0498B5B13CEA35F04387B1F02A3F396E0FCE97A3E7AF7AE026DA70F35BC2B7BFB7419F3763BF0AAE3F475D3E47EF0C44A2785EFFF14DA7EAB0EB1F33320F4CCCA282C6345E6A0CA16059CFD9678ED3613D07ACFD9510CCC08A7503E1BF1914445EC606B4B299AB95AE34C7B8DA8C2A93E10DF318E5991827563C72B81D81B5F93BEA2397199A5C254B88E7EA367369E626D642B2949DD760C00EFBCFDF0C5DCEC16DEA7FD96F1102D2141802DCAABF3221E39AF7F523F9B307C2674A598AC80ADF9108B7DED548375A1D0954CA378314942FE47B48528960F65685FC019EC30D1F7EEF60CDA35DD596F7833C7D115DD98399E06BC3135B6234E7FD972FF39FBEAF3E03A031162C2C0F0000 , N'6.2.0-61023')
END

IF @CurrentMigration < '201805111957138_RenameMethodName'
BEGIN
    ALTER TABLE [dbo].[Metrics] ADD [MetricName] [nvarchar](max)
    DECLARE @var1 nvarchar(128)
    SELECT @var1 = name
    FROM sys.default_constraints
    WHERE parent_object_id = object_id(N'dbo.Metrics')
    AND col_name(parent_object_id, parent_column_id) = 'MethodName';
    IF @var1 IS NOT NULL
        EXECUTE('ALTER TABLE [dbo].[Metrics] DROP CONSTRAINT [' + @var1 + ']')
    ALTER TABLE [dbo].[Metrics] DROP COLUMN [MethodName]
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201805111957138_RenameMethodName', N'Metricity.Data.Migrations.Configuration',  0x1F8B0800000000000400CD57C96E1B3910BD0F30FF40F034011CD1CB6112A3954023D98190C836D24EEE5477492686647748B621E5D7E6309F945F48B1F7C5926527C80C7CB1C8E2AB578FB5B0BFFDF36FF076A324B9076345A2C7F464744C09E82889855E8F69E6562F5FD1B76F7EFF2DB888D5867CAEECCEBC1D9ED4764CEF9C4BCF19B3D11D286E474A4426B1C9CA8DA244311E27ECF4F8F8353B3961801014B108093E66DA0905F90FFC394D7404A9CBB85C2431485BAEE34E98A3922BAEC0A63C82315D803322126E3B9A71C7299948C1914508724509D73A71DC21C7F34F16426712BD0E535CE0F2769B02DAADB8B450723F6FCC0F0DE3F8D487C19A831554945997A827029E9C95BAB0FEF167A94B6BDD50B90B54D86D7DD4B97A957094F45D9D4FA5F1667D69473982003B2AD68F4877FFA84E07CC1AFF7744A699749981B186CC192E8FC84DB694227A0FDBDBE46FD0639D49D926893471AFB3804B372649C1B8ED475875A8CF634A58F734EB1FAF0F0F4E1621CEB53B3BA5E40A89F0A5843A1F5A72842E31F00E3418EE20BEE1CE81C1EB9CC7902B3AE0D0F33849530C3987F20B9563CC452C294A167CF301F4DADD2137BEA1E4526C20AE564A329FB4C00AC443CE64F098BF22C25FE26A969932390B47B7C23B1D68D90609589387C3ECC4BA775CA0D29D58CA0DD8B8079215CBBACC575B92EE522E8043701D484B49C3A36816A3AA1E1EA25B136B3A112B5A51D5B2D88E9E152C789AA2FCAD1E56AE90B06860D397E1D3AB5B15180C23D92363ED095398AFA1B78BAE91E9A530D6F9FA5D727F59D3580DCC06D7B043E2CA5D57E97E3937C257F6FEFFDE85171DA7BC921E4223E12546A5B00CF300A1E651F7B6C1C17C8270C9CDCEB6304D64A6F4FE36B30F6950EE6DC0C1E6E1B8EDB21E727C2A5A53B96DAC66758814B09EE6FD6B65837BEDB5E67E9AEC2BB3BE49EDBD2EB75E5905658A3FFE5E18E47C6142094A742F629FEFE1D63A50450A865FE4540A8CB73158702D56605D31C3288EEDD3D1E42BCEB9DEE3E3FFF31060D6C6F2A0D7C07F3A8C8557F9D171BB77BE1C3C7FF53D37D11D377F28BE79D1067DDE8CFD21B8FE1C75F91CBD311089E279FDE74F9DAAC3AE7FC8C8DC33318B0A1AD37899600805CB7ACE3E739C0EEB3960EDAF84600656AC1B08FFCDA021F23236A095CD5CAF924A738CABCDA83219DE308F519E897162C52387DB11589BBFA33E7399A1C9855A423CD7D7994B3337B116D452765E8301DBEF3F7F33743907D7A9FF657F46084853600870ADFFCA848C6BDE970FE4CF0E089F296529222B7C4722DC7A5B235D25FA40A052BE19A4A07D21DF824A2582D96B1DF27B780E377CF87D80358FB6555BDE0DF2F84574650F6682AF0D57B6C468CEFB2F5FE63F7DDF7C07CC36E99C2C0F0000 , N'6.2.0-61023')
END

IF @CurrentMigration < '201805151846271_AddedHandledException'
BEGIN
    CREATE TABLE [dbo].[HandledExceptions] (
        [HandledExceptionId] [int] NOT NULL IDENTITY,
        [InnerException] [nvarchar](max),
        [ExceptionType] [nvarchar](max),
        [Occurred] [datetime] NOT NULL,
        CONSTRAINT [PK_dbo.HandledExceptions] PRIMARY KEY ([HandledExceptionId])
    )
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201805151846271_AddedHandledException', N'Metricity.Data.Migrations.Configuration',  0x1F8B0800000000000400CD58CD6EE33610BE17E83B083AB540D6CACFA16D20EFC2B593D6E83A0E56D9BDD3D2D8214A512A4905765FAD873E525FA143517FA62C47B693EC2297981C7EF3F77186A3FFFEF9D7FFB08E99F30442D2840FDD8BC1B9EB000F9388F2D5D0CDD4F2DDCFEE87F7DF7FE7DF44F1DAF952CA5D69393CC9E5D07D542ABDF63C193E424CE420A6A14864B2548330893D1225DEE5F9F92FDEC5850708E12296E3F89F32AE680CF90FFC394E7808A9CA089B25113059ACE34E90A33A77240699921086EE0C94A021559BC18428E23A2346095A11005BBA0EE13C5144A18DD79F25044A247C15A4B840D8C32605945B1226A1B0FDBA16EFEBC6F9A576C3AB0F9650612655121F08787155C4C5B38F1F155DB78A1B46EE0623AC36DAEB3C7A43F777C22306D1CD5A873A57612BBD1E33A10FD8411EE45814E4C0C63873B625CF2A8A2093F4DF9933CE98CA040C39644A1076E6DC670B46C33F60F390FC097CC833C69A86A3E9B8B7B5804BF7224941A8CD275876B8338D5CC7DBC6F16CA00A660F8609C094ABAB4BD7B943E3C88241C59B46B0029508F80D3808A220BA274A81C0B44F23C823DFB2C6D23DE578B2910CA317298B37CF756664FD11F84A3D622EC8DA756EE91AA272A5B0E533A77851F19012193CA7AED2A4F5BCBAB67918664240154EE4063CE085DF11D12690EFD5ACDDCB65C3BA63186CD6BF226F8DE263D85A9F7C2B8E8ED2145DCEA1F4C2ABD3C678F826AA269920CD8B77323BB187294231D25BBE141BB0563BC88A2DAAE0AB2C8CDE36D90007A03ACA95749DDA22D3025B15BA15071BD4D8B90BAABC64BB6250795BB76ACFF4EAB2A77B1D4DDD9F9134C59C369A7CB1E204A6C38FDF0587B7BFD86078E8C99EDC549AF05E901558BBA81A2DBDA5422A5D14164433601CC52DB1566E3B425CAAEB4A9F5D2DEA149427F5FF169F4C416BE5D9C2AAC37A8B9EC678DF73A7A1B26DC783A005913FC00823A247DF1C272C8B79DFDEBC0FDDEE8C4D647BAF3FAAD5009BA0D6567FCCBACD35E1EAD53692EF5959B129E0B5386075099B5CBDA8575EF21308575483C369D675B02BA8759B6B06B5AB6DEE436AB5AF26606BB33F6EB34DB56D3C14ADEE444DAC7AF58D49D4AAF0B648A5BDAAF45645F78BEAFAFC2CD72AB746C47530444F34D2A536D84805B1A160F0171B338AFED60233C2E912A4326F321747AACBC1E86F7CB75983E1B733A4795246ECC049ED9B1B8FA8CEC1B38FCBBDAFA9BE13117F22227C24E28798AC7F6C621E3DF59C84684F3611FAAE5E7EB2F9AA83C5AB64B76396382919ED79E124387B263079BD171052F3D9EBA7179D10DA8FCDC39EFFBD5EFFA6A2224F1709BA652CDF3147F41A12F6CC08BBD45493C5910344BB8DF85EF3C3A13F0149573584FE8CC821D41ED5A0A5CC942F9332DDE857D3A252A44D2E82B79B8C84A24B122ADC0E41CA7C1CFD4258A6CB4BBC8068CAE7994A33359212E205DB1AAA7D6FBFFE7C4ADAB6D99F9B9CBC840B6826D5056ACE7FCD288B2ABB6F7750B7034293B4A80268158EE308B7DA54487709EF0954846F0229705D431E204E1982C9390FC8131C631BCECF1F6145C24DF91AE806793E11DB61F72794AC04896581519FD71FC33DFD35FCFDFF6D319FF53F170000 , N'6.2.0-61023')
END

IF @CurrentMigration < '201805151908537_InnerExceptionToStackTrace'
BEGIN
    ALTER TABLE [dbo].[HandledExceptions] ADD [StackTrace] [nvarchar](max)
    DECLARE @var2 nvarchar(128)
    SELECT @var2 = name
    FROM sys.default_constraints
    WHERE parent_object_id = object_id(N'dbo.HandledExceptions')
    AND col_name(parent_object_id, parent_column_id) = 'InnerException';
    IF @var2 IS NOT NULL
        EXECUTE('ALTER TABLE [dbo].[HandledExceptions] DROP CONSTRAINT [' + @var2 + ']')
    ALTER TABLE [dbo].[HandledExceptions] DROP COLUMN [InnerException]
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201805151908537_InnerExceptionToStackTrace', N'Metricity.Data.Migrations.Configuration',  0x1F8B0800000000000400CD58CD72DB3610BE77A6EFC0E1A99D7144FF1CDA7AA8645CC96E3D892C4FA8E40E912B1913106401D023F5D57AE823E515B220F827509429C97632BE580BE0DBBF0FBB587EFDEF7FFFDD2A66CE230849133E74CF06A7AE033C4C22CA974337538B37BFBBEFDEFEFC937F1DC52BE773B9EF42EFC3935C0EDD07A5D24BCF93E103C4440E621A8A44260B350893D82351E29D9F9EFEE19D9D7980102E62398EFF31E38AC690FFC09FA3848790AA8CB049120193851C57821CD5B92331C89484307427A0040DA95A0FC64411D7B96294A01501B085EB10CE134514DA78F94942A044C297418A02C266EB1470DF82300985ED97F5F6BE6E9C9E6B37BCFA600915665225F19E806717455C3CFBF841D175ABB861E4AE31C26AADBDCEA33774FF263C62105DAF74A87315B6D2CB1113FA801DE4418E45410E6C8C136773E74945116492FE3B71461953998021874C09C24E9CFB6CCE68F81ED6B3E40BF021CF186B1A8EA6E3DA860045F7224941A8F5475874B8731BB98EB789E3D94015CC0E0C13805BAE2ECE5DE70E8D237306156F1AC10A5422E02FE0208882E89E280502D37E1B411EF9963596EE4091F0CB4C20A74B9D4857BC75AE3321AB0FC097EA01F34056AE734357109592C28E4F9CE225C5434A64F094AACA3FADE7C5B54DC3301302AA50222F6086977D4B349B40BE573376278F0DE30E61AF917F47CE1AC58730B53EF95AFCBC4A53743987D28217A78DF1F055548D33511459A3E8687662FF528462A4377C291660A5B69015DB53C1575918BD69B2010E4075942AE93AB545A6FDB5AA732B0E36A8B1731B5479C9B6C5A0F2B66ED39EE9D3653FF73A1ABA3F21698A396D34F842E204A6BB8FDE04FBB7BED86078E8C98EDC549AF05E902558ABA81A2DBDA1422A5D14E644336014C5AD6DADDC7684B854D7953EBB5AD429284FEAFF2D3E9982D6CAB3855587F5063D8DF1BEE74E4365DB96C7400B227F7C1146448F9E394A5816F3BE7D79177AB32B36519BF2FE6856E36B025A4BFD31EBF6D684ABA56D24DFB3B261A7DE6BE5DEEA0E36A97A51AEBCDC4710ADA802FBD3ABEB605750EBF6D60C6A57BBDC85D46A5B4DC0D6627FDC667B6ADBB82F5ADD819A58B5F49549D4AAECF6964A7B55E1AD4AEE1755F5E9F9AD5566CD16D7C1103DD24897D8602D15C48682C13F6CC428FA5B6F98104E172095798BB938469D0FAEFEC5F79A350CFE3883992765C4F69CCE7EB89188EA1C3CF9A8DCF98AEA3305F14722C207227E89C9EAD726DEC193CE5188F63413A1DFEAF9A799EF3A4CBC48663BE687A392D19E118E82B3E70093D77B0121359FB97E7BD6A9A0FDC0DCEFC9DFEBC56FAA29F2749EA05BC6F22DB343AFC160C75CB04D4D354D1C3834B45B88EF353F14FA6390745943E8CF861C42ED510D5AEEB9E58BA44C37FAD5B4A8DCD22617C1DB4DAE84A20B122A5C0E41CA7C04FD4C58A6CB4B3C87E8964F339566EA4A4A88E76C6390F6BDDDFAF3C968D3667F6A72F21C2EA0995417A829FF33A32CAAECBED942DD0E084DD2A20AA055388223DC725D21DD25BC275011BE31A4C0750D99419C320493531E904738C4369C993FC09284EBF225D00DF2742236C3EE8F29590A12CB02A33EAF3F7E7BFAEBF7DB6FD48B226D2F170000 , N'6.2.0-61023')
END

